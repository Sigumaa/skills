---
name: subagent-manager-workflow
description: 複数サブエージェントを使う開発タスクで、アシスタントをPM専任に固定し、実装・レビュー・テスト・コミットを担当別サブエージェントへ委譲して進める運用スキル。並列可能な作業は同時に実行し、依存関係がある作業だけを直列管理する。仕様選定や優先度調整などプロダクト意思決定が必要な場面でのみユーザーへ相談する。単独実装やサブエージェント未使用前提の依頼には適用しない。
---

# サブエージェント進行管理ワークフロー

## Overview
- このskillは、アシスタントがPMとして進行管理に専念する前提で使う。
- 実装、レビュー、テスト、コミットは必ずサブエージェントへ委譲する。
- ユーザー相談は、プロダクト意思決定が必要な局面に限定する。

## ワークフロー判定
- 次の依頼は発火して処理する。
  - 複数の実装タスクを分担し、進行だけ中央管理したい
  - 実装、レビュー、テスト、コミットを担当分離で回したい
  - 並列実行でリードタイムを短縮したい
- 次の依頼は発火せず他skillへ委譲する。
  - アシスタント単独で即時実装する依頼
  - サブエージェントを使わない運用が明示された依頼
  - 単発の調査や雑談のみの依頼
- 次の依頼は発火し、短い確認質問を返して判定する。
  - サブエージェントの担当範囲が未定義
  - ユーザー相談が必要な意思決定条件が未定義

## 実行手順
1. 依頼を受けたら、成果物、期限、完了条件を3行以内で固定する。
2. 作業を `実装` `レビュー` `テスト` `コミット` の機能部品単位に分解し、各部品の依存関係を明記する。
3. 各部品に担当サブエージェントを割り当て、PMが行う作業を `進捗管理` `依存調整` `意思決定ゲート管理` に限定する。
4. 依存しない部品は同時に着手させ、依存する部品だけ待ち合わせポイントを設定する。
5. サブエージェントには次のテンプレートで依頼する。
```text
[委譲依頼]
- 目的:
- 入力:
- 完了条件:
- 禁止事項:
- 返却物:
```
6. 実装完了後は、別サブエージェントへレビューを委譲し、指摘の反映担当もサブエージェントに割り当てる。
7. レビュー完了後は、別サブエージェントへテスト作成と実行を委譲し、結果をログとして回収する。
8. テスト完了後は、別サブエージェントへコミット作成を委譲し、コミットメッセージ規約を満たすことを確認する。
9. PMは成果物を統合し、仕様選択、優先度変更、受け入れ条件変更が必要な場合のみユーザーへ相談する。
10. ユーザー決定後は残タスクへ反映し、全サブエージェント結果をまとめて最終報告する。

## 禁止事項
- PMが実装、レビュー、テスト、コミットを直接実行すること。
- 並列可能な部品を根拠なく直列化すること。
- 仕様や優先度の変更を、ユーザー相談なしで確定すること。
- 完了条件が曖昧なままサブエージェントへ委譲すること。
- サブエージェント成果物の出典と担当を記録せずに統合すること。

## 品質ゲート
- 各機能部品について、`担当サブエージェント` `依存関係` `完了条件` が記録されていること。
- 並列可能な部品は2件以上で同時進行し、直列化理由を残していること。
- 実装、レビュー、テスト、コミットがすべて委譲され、PMの直接実行がないこと。
- ユーザー相談ログが「プロダクト意思決定」に限定されていること。
- `references/trigger-test-log.md` に肯定、否定、曖昧、境界ケースの検証結果があること。
- skill更新後は次を実行すること。
```bash
uv run --with pyyaml python /home/shiyui/.codex/skills/.system/skill-creator/scripts/quick_validate.py /home/shiyui/.codex/skills/subagent-manager-workflow
```

## 返答方針
- 返答は日本語で行い、PMが実施した管理作業と委譲作業を分けて示す。
- 進捗報告では、並列実行中のタスク、待機中タスク、意思決定待ちを明示する。
- ユーザー相談時は、決定が必要な論点、選択肢、推奨案を1回で提示する。
- 完了報告では、各機能部品の担当、テスト結果、コミット情報をまとめて示す。
