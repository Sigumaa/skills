---
name: subagent-manager-workflow
description: 複数サブエージェントで開発を進める際、Plan確定後に `.codex` と `.github` の運用基盤を自動整備し、PM専任で実装・レビュー・テスト・コミットを委譲運用するスキル。典型要求は「Planから実装へ移したい」「運用ファイルを一括生成したい」「並列委譲で進行したい」。単独実装依頼、サブエージェント非利用、雑談のみには使用しない。
---

# サブエージェント進行管理ワークフロー

## Overview
- このskillは、アシスタントをPM専任に固定して進行管理を行う。
- Plan確定後に必要なら `.codex` と `.github` の運用基盤を先に整備する。
- 実装、レビュー、テスト、コミットは必ずサブエージェントへ委譲する。
- ユーザー相談はプロダクト意思決定が必要な局面に限定する。

## ワークフロー判定
- 次の依頼は発火して処理する。
  - Planを実装フェーズへ移すために運用ファイルを一括整備したい
  - `.codex` 配下の計画ファイルと `.github/workflows` を整えた上で委譲運用したい
  - 複数サブエージェントで並列実行し、PMは進捗管理に専念したい
- 次の依頼は発火せず他skillへ委譲する。
  - アシスタント単独で即時実装する依頼
  - サブエージェントを使わない運用が明示された依頼
  - 単発の調査や雑談のみの依頼
- 次の依頼は発火し、短い確認質問を返して判定する。
  - ブートストラップ対象ファイルの責務が未定義
  - CI運用方針や品質ゲートの強制範囲が未定義

## 実行手順
1. 依頼受領時に、成果物、期限、完了条件を3行以内で固定する。
2. Plan確定状態を確認し、`.codex/PROJECT_PLAN.md` と `.codex/PLAN_PROGRESS.md` の有無を確認する。
3. 運用基盤の不足を判定し、必要なら `references/bootstrap-file-contract.md` に従って次を生成または更新する。
   - `.codex/PROJECT_PLAN.md`
   - `.codex/PLAN_PROGRESS.md`
   - `.codex/STARTUP_CHECKLIST.md`
   - `.github/workflows/*.yml`（最低1本）
4. ブートストラップ後に対象フェーズと対象項目を明示し、`PLAN_PROGRESS` の現在地を更新する。
5. 作業を `実装` `レビュー` `テスト` `コミット` の機能部品単位に分解し、依存関係を明記する。
6. 各部品に担当サブエージェントを割り当て、PMの作業を `進捗管理` `依存調整` `意思決定ゲート管理` に限定する。
7. 依存しない部品は同時着手し、依存する部品だけ待ち合わせポイントを設定する。
8. サブエージェントには次のテンプレートで委譲する。
```text
[委譲依頼]
- 目的:
- 入力:
- 完了条件:
- 禁止事項:
- 返却物:
```
9. 実装完了後は別サブエージェントへレビューを委譲し、指摘反映担当も別サブエージェントに割り当てる。
10. レビュー完了後は別サブエージェントへテスト作成と実行を委譲し、結果ログを回収する。
11. テスト完了後は別サブエージェントへコミット作成を委譲し、Conventional Commit準拠を確認する。
12. push後のCI監視が必要な場合は `$gh-workflow` を併用し、最新run監視まで完了する。
13. PMは成果物を統合し、仕様選択や優先度変更が必要な場合のみユーザーへ相談する。

## 禁止事項
- PMが実装、レビュー、テスト、コミットを直接実行すること。
- Plan未確認のまま委譲タスクを開始すること。
- ブートストラップ不足を放置したまま実装フェーズへ進むこと。
- 並列可能な部品を根拠なく直列化すること。
- 仕様や優先度の変更をユーザー相談なしで確定すること。
- サブエージェント成果物の出典と担当を記録せずに統合すること。

## 品質チェック
- ブートストラップ対象ファイルの存在と責務が `references/bootstrap-file-contract.md` と一致していること。
- 各機能部品について、`担当サブエージェント` `依存関係` `完了条件` が記録されていること。
- 並列可能な部品は2件以上で同時進行し、直列化理由を残していること。
- 実装、レビュー、テスト、コミットがすべて委譲され、PMの直接実行がないこと。
- `references/trigger-test-log.md` に肯定、否定、曖昧、境界ケースの検証結果があること。
- skill更新後は次を実行すること。
```bash
uv run --with pyyaml python /home/shiyui/.codex/skills/.system/skill-creator/scripts/quick_validate.py /home/shiyui/.codex/skills/subagent-manager-workflow
```

## 返答方針
- 返答は日本語で行い、ブートストラップ状況と委譲状況を分けて示す。
- 進捗報告では、並列実行中タスク、待機中タスク、意思決定待ちを明示する。
- ユーザー相談時は、決定が必要な論点、選択肢、推奨案を1回で提示する。
- 完了報告では、各機能部品の担当、テスト結果、コミット情報、CI監視結果をまとめて示す。
