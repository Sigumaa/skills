# 失敗復旧プレイブック

## 基本方針
- 失敗は `失敗タイプ` を先に特定してから対処する。
- 同一失敗の再実行は最大2サイクルまでとし、超過時は `decision-gates.md` で相談判定する。
- 復旧作業も担当分離を維持し、PMは直接修正しない。

## 失敗タイプ別手順

### 1. テスト失敗
1. テスト担当が失敗ログ、再現手順、失敗テスト名を返却する。
2. PMは実装担当へ修正を再委譲する。
3. 修正後、別担当に再テストを委譲する。
4. passしたら元のフローへ復帰する。

### 2. CI失敗
1. CIログから失敗ジョブと失敗ステップを特定する。
2. 失敗原因を `環境起因` `テスト起因` `実装起因` に分類する。
3. 原因別に担当を再割当てして修正/再実行する。
4. 必要なら `$gh-workflow` を使って対象runを監視する。

### 3. 競合（マージ/ファイル競合）
1. 競合ファイルと競合範囲を列挙する。
2. PMは依存グラフを見直し、競合部品を直列化する。
3. 実装担当へ競合解消を委譲し、レビュー担当へ差分確認を委譲する。
4. 競合解消後にテスト担当で回帰確認する。

### 4. 品質ゲート失敗（pre-commit/lint/type/test）
1. どの品質ゲートで失敗したかを1件ずつ分離する。
2. 実装担当へ修正を委譲し、テスト担当へ再実行を委譲する。
3. 全ゲートpassまで反復し、2サイクル超過でユーザー相談へ遷移する。

## 復旧ログの固定項目
- 失敗タイプ
- 発生時刻
- 影響範囲
- 再委譲先
- 再実行結果
- 次アクション
