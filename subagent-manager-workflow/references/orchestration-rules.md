# 並列オーケストレーション規約

## 並列可否の判定表

| 判定軸 | yes（並列可） | no（直列化） | 備考 |
|---|---|---|---|
| 入出力依存 | 互いの成果物を参照しない | 片方の出力を他方が入力に使う | 依存があれば `depends_on` を必須化 |
| ファイル更新競合 | 更新対象が完全に分離 | 同一ファイルまたは同一ブロックを更新 | 同一ファイルは原則1担当に集約 |
| 実行環境共有 | 独立セッションや独立ブランチ | 同一環境ロックを奪い合う | DB migration などは直列化 |
| 品質ゲート順序 | レビュー/テスト待ち不要の前段作業 | 実装未完了なのにレビュー/テスト開始 | `実装 -> レビュー -> テスト -> コミット` を厳守 |
| 意思決定依存 | 仕様固定済み | 仕様未確定で作業が分岐 | `decision-gates.md` で相談判定 |

## 依存グラフ化ルール
1. 機能部品ごとに `task_id` を付与する。
2. 機能部品は `.codex/PROPOSED_PLAN.md` の `PP-05` と1対1対応させる。
3. 各部品に `type`（implementation/review/test/commit）を付与する。
4. 各部品に `depends_on` を列挙し、依存先が空なら並列候補とする。
5. 同一機能の品質ゲートは `implementation -> review -> test -> commit` の順で必ず依存線を張る。
6. 競合リスクがある部品は、依存がなくても直列化して理由を記録する。
7. PMはクリティカルパスと待機キューを分けて管理する。

## 待ち合わせ条件
- 実装待ち合わせ: レビュー委譲前に「実装担当の完了報告」と「変更ファイル一覧」が揃うこと。
- レビュー待ち合わせ: テスト委譲前に「レビュー指摘の反映完了」が確認できること。
- テスト待ち合わせ: コミット委譲前に「必須テストのpass結果」と「失敗時復旧ログ」が揃うこと。
- コミット待ち合わせ: PM統合報告前に「コミットID」「対象ファイル」「品質ゲート結果」が揃うこと。

## 直列化理由の最小記録
- `task_id`
- `直列化理由`
- `解除条件`
- `見直し時刻`
- `参照plan_section`（`.codex/PROPOSED_PLAN.md` の `PP-05` または `PP-07`）

## 直列化記録テンプレート
```text
- task_id:
- 直列化理由:
- 解除条件:
- 見直し時刻:
- 参照plan_section:
```
